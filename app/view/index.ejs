<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>VirtualDiary E3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Courier+Prime&display=swap" rel="stylesheet">
    <style>
        /* Paste Style CSS lengkap dari kode sebelumnya di sini agar tampilan konsisten */
        :root { --book-width: 420px; --book-height: 580px; --classic-bg: #f4ecd8; --midnight-bg: #2c3e50; --lavender-bg: #f3e5f5; --cover-grey: #8a9ea8; --cover-dark: #6b7f88; --brass-light: #cfa76e; --brass-dark: #8c6a3a; }
        body { background: radial-gradient(circle at center, #5d4037 0%, #3e2723 100%); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; perspective: 2000px; overflow: hidden; font-family: 'Cinzel', serif; }
        .book-container { position: relative; width: var(--book-width); height: var(--book-height); transition: transform 0.6s; transform-style: preserve-3d; box-shadow: 0 30px 60px rgba(0,0,0,0.6); border-radius: 10px; }
        .book-container.open { transform: translateX(50%); }
        .page { position: absolute; width: 100%; height: 100%; top: 0; left: 0; transform-origin: left; transform-style: preserve-3d; transition: transform 0.8s; cursor: pointer; border-radius: 0 12px 12px 0; }
        .front, .back { position: absolute; width: 100%; height: 100%; top: 0; left: 0; backface-visibility: hidden; padding: 3rem 2.5rem; display: flex; flex-direction: column; background: #fff; box-shadow: inset 5px 0 15px rgba(0,0,0,0.1); }
        .back { transform: rotateY(180deg); border-radius: 12px 0 0 12px; box-shadow: inset -5px 0 15px rgba(0,0,0,0.1); }
        .page.flipped { transform: rotateY(-180deg); }
        
        /* Styles Cover & Page Colors (Sama seperti sebelumnya) */
        .page.cover .front { background: linear-gradient(135deg, var(--cover-grey), var(--cover-dark)); color: #333; border: 3px dashed rgba(0,0,0,0.2); justify-content: flex-start; padding-top: 5rem; align-items: center; }
        .classic .front, .classic .back { background: var(--classic-bg); color: #5d4037; border-left: 5px solid #d7ccc8; }
        .midnight .front, .midnight .back { background: var(--midnight-bg); color: #eceff1; border-left: 5px solid #455a64; }
        .lavender .front, .lavender .back { background: var(--lavender-bg); color: #4a148c; border-left: 5px solid #e1bee7; }
        .content-lines { background-image: linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px); background-size: 100% 2rem; line-height: 2rem; height: 100%; font-family: 'Courier Prime', monospace; overflow-y: auto; white-space: pre-wrap; }
        
        /* Lock Decoration */
        .lock-strap { position: absolute; top: 50%; right: -15px; transform: translateY(-50%); width: 100px; height: 70px; background: var(--cover-dark); border-radius: 5px; border: 2px dashed rgba(0,0,0,0.3); z-index: 2; }
        .brass-lock { position: absolute; top: 50%; right: 20px; transform: translateY(-50%); width: 120px; height: 50px; z-index: 3; background: linear-gradient(to bottom, var(--brass-light), var(--brass-dark), var(--brass-light)); border-radius: 8px; border: 1px solid var(--brass-dark); display: flex; justify-content: space-evenly; align-items: center; }
        .lock-dial { width: 20px; height: 35px; background: #333; color: white; display: flex; justify-content: center; align-items: center; font-family: 'Courier Prime', monospace; border-radius: 3px; }

        .ui-controls { position: fixed; bottom: 2rem; display: flex; gap: 1rem; z-index: 200; }
    </style>
</head>
<body>
    <div class="book-container" id="book">
        <% pages.reverse().forEach((page, index) => { %>
            <div class="page <%= page.page_style %>" id="p<%= index + 1 %>">
                <div class="front">
                    <div style="font-size: 0.8rem; opacity: 0.6;"><%= new Date(page.created_at).toLocaleDateString('id-ID') %></div>
                    <h2 class="text-xl font-bold mb-2 mt-1"><%= page.nickname %></h2>
                    <div class="content-lines"><%= page.content %></div>
                    
                    <% if (user && user.id === page.author_id) { %>
                        <div class="mt-auto flex justify-end gap-2 opacity-100 z-50 pt-4 border-t border-black/10">
                            <a href="/edit/<%= page.id %>" class="text-blue-600 text-xs font-bold hover:underline">EDIT</a>
                            <form action="/delete/<%= page.id %>" method="POST" style="display:inline;">
                                <button class="text-red-600 text-xs font-bold hover:underline">HAPUS</button>
                            </form>
                        </div>
                    <% } %>
                </div>
                <div class="back"></div>
            </div>
        <% }) %>

        <div class="page cover" id="p0">
            <div class="front">
                <div style="font-size: 1.6rem; font-weight: bold; text-align: center;">VIRTUAL DIARY</div>
                <div style="font-size: 0.8rem; letter-spacing: 3px; text-align: center; margin-bottom: 2rem;">GROUP E3</div>
                <div class="bg-white/60 p-6 rounded-lg text-center w-3/4 backdrop-blur-sm">
                    <% if (user) { %>
                        <p class="text-sm">Writer: <b><%= user.nickname %></b></p>
                        <form action="/logout" method="POST"><button class="text-xs text-red-600 font-bold underline">Logout</button></form>
                    <% } else { %>
                        <p class="text-sm font-bold">"Everyone Diary's Book"</p>
                        <a href="/login" class="text-xs bg-[#2c3e50] text-white px-3 py-1 rounded inline-block mt-2">Login</a>
                    <% } %>
                </div>
                <div class="lock-strap"></div>
                <div class="brass-lock">
                    <div class="lock-dial"><%= user ? 'O' : '0' %></div><div class="lock-dial"><%= user ? 'P' : '0' %></div><div class="lock-dial"><%= user ? 'N' : '0' %></div>
                </div>
            </div>
            <div class="back bg-gray-100"></div>
        </div>
    </div>

    <div class="ui-controls">
        <button class="bg-white px-4 py-2 rounded-full shadow-lg font-bold" onclick="goPrev()">←</button>
        <% if (user) { %>
            <a href="/add" class="bg-gradient-to-b from-[#d4af37] to-[#aa8a29] text-white border border-[#8c6a3a] px-4 py-2 rounded shadow-lg font-bold no-underline flex items-center">✍ Tulis Baru</a>
        <% } else { %>
            <a href="/login" class="bg-white px-6 py-2 rounded shadow-lg font-bold text-[#5d4037] no-underline flex items-center">Login</a>
            <a href="/register" class="bg-[#2c3e50] text-white px-6 py-2 rounded shadow-lg font-bold no-underline flex items-center">Daftar</a>
        <% } %>
        <button class="bg-white px-4 py-2 rounded-full shadow-lg font-bold" onclick="goNext()">→</button>
    </div>

    <script>
        // LOGIKA FLIPBOOK (Sama seperti sebelumnya)
        const book = document.getElementById('book');
        const pages = Array.from(document.querySelectorAll('.page')).reverse();
        let currentLocation = 0; let totalPages = pages.length;
        function goNext() { if (currentLocation < totalPages) { if (currentLocation === 0) book.classList.add('open'); pages[currentLocation].classList.add('flipped'); pages[currentLocation].style.zIndex = currentLocation + 1; currentLocation++; } }
        function goPrev() { if (currentLocation > 0) { currentLocation--; pages[currentLocation].classList.remove('flipped'); pages[currentLocation].style.zIndex = totalPages - currentLocation; if (currentLocation === 0) book.classList.remove('open'); } }
        pages.forEach((page) => { page.addEventListener('click', (e) => { if(['A', 'BUTTON'].includes(e.target.tagName)) return; if (!page.classList.contains('flipped')) goNext(); else goPrev(); }); });
    </script>
</body>
</html>