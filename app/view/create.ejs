<!DOCTYPE html>
<html lang="id">
<head>
    <title>Tulis Cerita</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Courier+Prime&display=swap" rel="stylesheet">
    <style>
        body { background: #3e2723; min-height: 100vh; display: flex; align-items: center; justify-content: center; font-family: 'Cinzel', serif; }
        
        .card { display: flex; width: 950px; max-width: 95vw; height: 600px; background: #fffaf0; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .left { width: 50%; padding: 2.5rem; display: flex; flex-direction: column; justify-content: center; background: #fffaf0; z-index: 10; }
        .right { width: 50%; background: #2c2c2c; display: flex; align-items: center; justify-content: center; position: relative; box-shadow: inset 10px 0 20px rgba(0,0,0,0.2); }
        
        /* --- KUNCI: CSS UNTUK GARIS KERTAS PRESISI --- */
        .preview-page { 
            width: 360px; height: 500px; 
            padding: 2.5rem; 
            border-radius: 5px 15px 15px 5px; 
            box-shadow: 10px 10px 30px rgba(0,0,0,0.5); 
            display: flex; flex-direction: column;
            transition: background 0.3s;
        }

        /* Area Teks Bergaris */
        .lined-content {
            font-family: 'Courier Prime', monospace;
            font-size: 0.95rem; 
            line-height: 2rem; /* Jarak antar baris teks */
            width: 100%; height: 100%;
            background-image: linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 100% 2rem; /* Jarak antar garis kertas (HARUS SAMA DENGAN LINE-HEIGHT) */
            background-attachment: local;
            border: none; resize: none; outline: none;
            background-color: transparent;
            color: inherit;
            overflow-y: auto;
            white-space: pre-wrap; word-wrap: break-word;
            margin-top: 10px;
        }

        /* Header Preview (Tanggal & Nama) */
        .preview-header { border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 10px; margin-bottom: 0px; }
        .preview-date { font-size: 0.7rem; opacity: 0.6; font-family: sans-serif; margin-bottom: 5px; }
        .preview-name { font-size: 1.1rem; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }

        /* TEMA */
        .classic { background: #f4ecd8; color: #5d4037; }
        .midnight { background: #2c3e50; color: #eceff1; }
        .midnight .lined-content { background-image: linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .midnight .preview-header { border-bottom: 1px solid rgba(255,255,255,0.2); }
        
        .lavender { background: #f3e5f5; color: #4a148c; }
        .lavender .lined-content { background-image: linear-gradient(rgba(74, 20, 140, 0.1) 1px, transparent 1px); }
        .lavender .preview-header { border-bottom: 1px solid rgba(74, 20, 140, 0.2); }

        .btn-gold { background: linear-gradient(to bottom, #d4af37, #aa8a29); color: white; padding: 0.8rem; width: 100%; font-weight: bold; border-radius: 5px; margin-top: 1rem; cursor: pointer; transition: 0.2s; }
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(212, 175, 55, 0.4); }
    </style>
</head>
<body>
    <div class="card">
        <div class="left">
            <h2 class="text-2xl font-bold mb-4 text-[#5d4037]">Tulis Cerita</h2>
            <form action="/add" method="POST">
                <div class="mb-4">
                    <label class="block text-sm font-bold text-[#8c6a3a] mb-2">TEMA KERTAS:</label>
                    <select name="style" id="themeSelect" class="w-full p-2 border border-[#8c6a3a] rounded font-serif outline-none focus:ring-2 focus:ring-[#d4af37]">
                        <option value="classic">Classic (Vintage)</option>
                        <option value="midnight">Midnight (Dark)</option>
                        <option value="lavender">Lavender (Pastel)</option>
                    </select>
                </div>
                <div class="flex-grow mb-2">
                    <label class="block text-sm font-bold text-[#8c6a3a] mb-2">ISI DIARY:</label>
                    <textarea name="content" id="contentInput" rows="10" class="w-full p-3 border border-gray-300 rounded font-[Courier] text-sm resize-none focus:border-[#8c6a3a] outline-none h-64" placeholder="Ketik di sini..." required></textarea>
                </div>
                <button type="submit" class="btn-gold">Terbitkan Halaman</button>
            </form>
            <a href="/" class="text-center text-xs text-gray-400 mt-4 hover:text-[#8c6a3a] no-underline">Batal & Kembali</a>
        </div>

        <div class="right">
            <div class="absolute top-4 text-white/30 text-xs tracking-widest uppercase">Live Preview</div>
            
            <div id="previewPage" class="preview-page classic">
                <div class="preview-header">
                    <div class="preview-date"><%= new Date().toLocaleDateString('id-ID') %></div>
                    <div class="preview-name"><%= user ? user.nickname : 'Penulis' %></div>
                </div>
                
                <div id="previewText" class="lined-content">...</div>
            </div>
        </div>
    </div>

    <script>
        const themeSelect = document.getElementById('themeSelect');
        const contentInput = document.getElementById('contentInput');
        const previewPage = document.getElementById('previewPage');
        const previewText = document.getElementById('previewText');

        // Ganti Tema
        themeSelect.addEventListener('change', (e) => {
            previewPage.className = `preview-page ${e.target.value}`;
        });

        // Live Typing
        contentInput.addEventListener('input', (e) => {
            // Gunakan innerText agar enter terbaca sebagai baris baru
            previewText.innerText = e.target.value || "...";
        });
    </script>
</body>
</html>